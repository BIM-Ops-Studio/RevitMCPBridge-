{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://revitmcpbridge/schemas/test_artifact.schema.json",
  "title": "Test Artifact",
  "description": "Schema for Method Gym test artifacts",
  "type": "object",
  "required": ["testId", "methodName", "createdAt", "taskRequest", "expectedOutcome"],
  "properties": {
    "testId": {
      "type": "string",
      "pattern": "^[a-z0-9_]+_\\d{8}_\\d{6}$",
      "description": "Unique test ID: methodname_YYYYMMDD_HHMMSS"
    },
    "methodName": {
      "type": "string",
      "description": "Method being tested"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time"
    },
    "triggerType": {
      "type": "string",
      "enum": ["manual", "failure_recovery", "regression", "new_implementation"],
      "description": "What triggered this test"
    },
    "taskRequest": {
      "type": "object",
      "required": ["method", "params"],
      "properties": {
        "method": {"type": "string"},
        "params": {"type": "object"},
        "userIntent": {"type": "string", "description": "Natural language of what user wanted"},
        "context": {"type": "string", "description": "Additional context"}
      }
    },
    "initialState": {
      "type": "object",
      "description": "Revit state snapshot before execution",
      "properties": {
        "projectName": {"type": "string"},
        "projectPath": {"type": "string"},
        "activeViewId": {"type": "integer"},
        "activeViewName": {"type": "string"},
        "activeViewType": {"type": "string"},
        "selectedElementIds": {
          "type": "array",
          "items": {"type": "integer"}
        },
        "elementCounts": {
          "type": "object",
          "additionalProperties": {"type": "integer"}
        },
        "revitVersion": {"type": "string"},
        "timestamp": {"type": "string", "format": "date-time"}
      }
    },
    "expectedOutcome": {
      "type": "object",
      "required": ["success"],
      "properties": {
        "success": {"type": "boolean"},
        "assertions": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "expected"],
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "elementCreated", "elementDeleted", "elementModified",
                  "countEquals", "countIncreased", "countDecreased",
                  "parameterEquals", "parameterChanged",
                  "viewCreated", "viewModified",
                  "errorType", "noError"
                ]
              },
              "target": {"type": "string"},
              "expected": {},
              "tolerance": {"type": "number"}
            }
          }
        },
        "returnData": {
          "type": "object",
          "description": "Expected fields in return data"
        }
      }
    },
    "execution": {
      "type": "object",
      "properties": {
        "startedAt": {"type": "string", "format": "date-time"},
        "completedAt": {"type": "string", "format": "date-time"},
        "durationMs": {"type": "integer"},
        "status": {
          "type": "string",
          "enum": ["pending", "running", "passed", "failed", "error", "skipped"]
        }
      }
    },
    "actualResult": {
      "type": "object",
      "properties": {
        "success": {"type": "boolean"},
        "response": {"type": "object"},
        "error": {"type": "string"},
        "stackTrace": {"type": "string"}
      }
    },
    "assertionResults": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "assertion": {"type": "object"},
          "passed": {"type": "boolean"},
          "actual": {},
          "message": {"type": "string"}
        }
      }
    },
    "evidence": {
      "type": "object",
      "properties": {
        "createdElementIds": {
          "type": "array",
          "items": {"type": "integer"}
        },
        "modifiedElementIds": {
          "type": "array",
          "items": {"type": "integer"}
        },
        "deletedElementIds": {
          "type": "array",
          "items": {"type": "integer"}
        },
        "screenshots": {
          "type": "array",
          "items": {"type": "string"}
        },
        "logs": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "runLog": {
      "type": "array",
      "description": "Detailed execution log",
      "items": {
        "type": "object",
        "properties": {
          "timestamp": {"type": "string", "format": "date-time"},
          "level": {"type": "string", "enum": ["debug", "info", "warn", "error"]},
          "message": {"type": "string"},
          "data": {"type": "object"}
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "retryCount": {"type": "integer"},
        "isRegression": {"type": "boolean"},
        "parentTestId": {"type": "string"},
        "tags": {
          "type": "array",
          "items": {"type": "string"}
        },
        "notes": {"type": "string"}
      }
    }
  }
}
